{"ast":null,"code":"//authService.js\n\nimport axios from 'axios';\nimport config from '../../config';\nconst API_BASE_URL = config.apiUrl;\nconst authService = {\n  userRegistration: async (fullName, username, password) => {\n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/auth/register`, {\n        fullName,\n        username,\n        password\n      });\n      console.log(response.data);\n    } catch (error) {\n      console.error('Error during signup:', error);\n      throw error;\n    }\n  },\n  userLogin: async (username, password) => {\n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/auth/login`, {\n        username,\n        password\n      });\n      const {\n        token,\n        refreshToken\n      } = response.data;\n      localStorage.setItem('token', token);\n      localStorage.setItem('refreshToken', refreshToken);\n      return token;\n    } catch (error) {\n      console.error('Error during login:', error);\n      throw error;\n    }\n  },\n  refreshAccessToken: async () => {\n    try {\n      let refreshToken = localStorage.getItem('refreshToken');\n      if (!refreshToken) {\n        const response = await axios.get(`${API_BASE_URL}/api/auth/refreshAccessToken`);\n        refreshToken = response.data.refreshToken;\n        localStorage.setItem('refreshToken', refreshToken);\n      }\n      const response = await axios.get(`${API_BASE_URL}/api/auth/refreshAccessToken`, {\n        refreshToken\n      });\n      console.log('response in refreshAccessToken', response);\n      const newToken = response.data.accessToken;\n      localStorage.setItem('token', newToken);\n      return newToken;\n    } catch (error) {\n      console.error('Error refreshing access token:', error);\n      throw error;\n    }\n  },\n  checkUserTokenExpiry: () => {\n    const expirationTime = Math.floor(Date.now() / 1000) + 50;\n    const currentTime = Date.now() / 1000;\n    return currentTime < expirationTime;\n  },\n  makeAuthenticatedRequest: async (url, options = {}) => {\n    try {\n      let token = localStorage.getItem('token');\n      if (!token) {\n        throw new Error('No token available');\n      }\n      const isTokenExpired = authService.checkUserTokenExpiry(token);\n      if (isTokenExpired) {\n        token = await authService.refreshAccessToken();\n        if (!token) {\n          throw new Error('Failed to refresh token');\n        }\n      }\n      const response = await axios(url, {\n        ...options,\n        headers: {\n          ...options.headers,\n          Authorization: `Bearer ${token}`\n        }\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Authenticated request error:', error);\n      throw error;\n    }\n  }\n};\nexport default authService;","map":{"version":3,"names":["axios","config","API_BASE_URL","apiUrl","authService","userRegistration","fullName","username","password","response","post","console","log","data","error","userLogin","token","refreshToken","localStorage","setItem","refreshAccessToken","getItem","get","newToken","accessToken","checkUserTokenExpiry","expirationTime","Math","floor","Date","now","currentTime","makeAuthenticatedRequest","url","options","Error","isTokenExpired","headers","Authorization"],"sources":["D:/NBAD/NBAD-React_Final_Project-main_1/NBAD-React_Final_Project-main/src/components/services/authService.js"],"sourcesContent":["//authService.js\n\nimport axios from 'axios';\nimport config from '../../config';\n\nconst API_BASE_URL = config.apiUrl;\n\nconst authService = {\n  userRegistration: async (fullName, username, password) => {\n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/auth/register`, {\n        fullName,\n        username,\n        password,\n      });\n      console.log(response.data);\n    } catch (error) {\n      console.error('Error during signup:', error);\n      throw error;\n    }\n  },\n\n  userLogin: async (username, password) => {\n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/auth/login`, {\n        username,\n        password,\n      });\n\n      const { token, refreshToken } = response.data;\n      localStorage.setItem('token', token);\n      localStorage.setItem('refreshToken', refreshToken);\n\n      return token;\n    } catch (error) {\n      console.error('Error during login:', error);\n      throw error;\n    }\n  },\n\n  refreshAccessToken: async () => {\n    try {\n      let refreshToken = localStorage.getItem('refreshToken');\n      if (!refreshToken) {\n        const response = await axios.get(`${API_BASE_URL}/api/auth/refreshAccessToken`);\n        refreshToken = response.data.refreshToken;\n\n        localStorage.setItem('refreshToken', refreshToken);\n      }\n      const response = await axios.get(`${API_BASE_URL}/api/auth/refreshAccessToken`, {\n        refreshToken,\n      });\n      console.log('response in refreshAccessToken', response);\n      const newToken = response.data.accessToken;\n      localStorage.setItem('token', newToken);\n\n      return newToken;\n    } catch (error) {\n      console.error('Error refreshing access token:', error);\n      throw error;\n    }\n  },\n\n  checkUserTokenExpiry: () => {\n    const expirationTime = Math.floor(Date.now() / 1000) + 50; \n    const currentTime = Date.now() / 1000; \n\n    return currentTime < expirationTime;\n  },\n\n  makeAuthenticatedRequest: async (url, options = {}) => {\n    try {\n      let token = localStorage.getItem('token');\n\n      if (!token) {\n        throw new Error('No token available');\n      }\n\n      const isTokenExpired = authService.checkUserTokenExpiry (token);\n\n      if (isTokenExpired) {\n        token = await authService.refreshAccessToken();\n        if (!token) {\n          throw new Error('Failed to refresh token');\n        }\n      }\n\n      const response = await axios(url, {\n        ...options,\n        headers: {\n          ...options.headers,\n          Authorization: `Bearer ${token}`,\n        },\n      });\n\n      return response.data;\n    } catch (error) {\n      console.error('Authenticated request error:', error);\n      throw error;\n    }\n  },\n};\n\nexport default authService;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}